<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">

<title>Run labs in container</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../assets/images/banner.jpg);
background-size: cover;
      }
</style>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Fira+Mono&amp;family=Nunito:ital,wght@0,400;0,500;0,600;1,400;1,500;1,600&amp;display=swap" rel="stylesheet">

<link href="../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/logos/nbis-scilifelab.png" alt="nbis-scilifelab-logo" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_schedule.html" rel="" target="">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_contents.html" rel="" target="">
 <span class="menu-text">Contents</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_precourse.html" rel="" target="">
 <span class="menu-text">Precourse</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_syllabus.html" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_info.html" rel="" target="">
 <span class="menu-text">Info</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/NBISweden/workshop-scRNAseq/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Run labs in container</h1>
            <p class="subtitle lead">Instructions on running labs on SciLifeLab Serve or locally in Docker</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#option-a-run-labs-on-scilifelab-serve-recommended" id="toc-option-a-run-labs-on-scilifelab-serve-recommended" class="nav-link active" data-scroll-target="#option-a-run-labs-on-scilifelab-serve-recommended"><span class="header-section-number">1</span> <strong>Option A:</strong> Run labs on SciLifeLab Serve (Recommended)</a></li>
  <li><a href="#option-b-run-docker-locally" id="toc-option-b-run-docker-locally" class="nav-link" data-scroll-target="#option-b-run-docker-locally"><span class="header-section-number">2</span> <strong>Option B:</strong> Run Docker Locally</a>
  <ul>
  <li><a href="#local-setup" id="toc-local-setup" class="nav-link" data-scroll-target="#local-setup"><span class="header-section-number">2.1</span> Local Setup</a></li>
  <li><a href="#images" id="toc-images" class="nav-link" data-scroll-target="#images"><span class="header-section-number">2.2</span> Images</a></li>
  <li><a href="#seuratbioconductor" id="toc-seuratbioconductor" class="nav-link" data-scroll-target="#seuratbioconductor"><span class="header-section-number">2.3</span> Seurat/Bioconductor</a></li>
  <li><a href="#scanpy" id="toc-scanpy" class="nav-link" data-scroll-target="#scanpy"><span class="header-section-number">2.4</span> Scanpy</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Three different toolkits, namely <strong>Seurat</strong> (R/RStudio), <strong>Bioconductor</strong> (R/RStudio) and <strong>Scanpy</strong> (Python/Jupyter) are available to perform the scRNAseq analysis. The labs can be run on SciLifeLab Serve or on your local machine using Docker. Both options provide the necessary environment to run the analysis.<br>
If you use SciLifeLab Serve, you do not need any local installation or setup on your system but you need a SciLifeLab Serve account. If you use Docker, you will need to set up and run Docker yourself.</p>
</div>
</div>
<section id="option-a-run-labs-on-scilifelab-serve-recommended" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="option-a-run-labs-on-scilifelab-serve-recommended"><span class="header-section-number">1</span> <strong>Option A:</strong> Run labs on SciLifeLab Serve (Recommended)</h2>
<ol type="1">
<li>Log in with your university email account to <a href="https://serve.scilifelab.se/accounts/login">SciLifeLab Serve</a>.</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>This step requires that you are <a href="https://serve.scilifelab.se/signup">registered</a>, and your account was given access to the course materials. If you did not register yet, please follow the <a href="../home_precourse.html">precourse information</a> and send an email to <code>serve@scilifelab.se</code> and let them know that you completed the registration.</p>
</div>
</div>
<ol start="2" type="1">
<li>Select <em>My projects</em> from the main menu. You should see a project called <strong>SCRNASEQ_VT25</strong>. Click <em>Open</em>.</li>
</ol>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="./assets/serve_lab_project.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="./assets/serve_lab_project.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<ol start="3" type="1">
<li>In the <strong>SCRNASEQ_VT25</strong> project, you can create an RStudio (for <strong>Seurat</strong>/<strong>Bioconductor</strong>) or JupyterLab (for <strong>Scanpy</strong>) notebook server instance, depending on which toolkit you choose to work with, by clicking the <em>Create</em> button.</li>
</ol>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="./assets/serve_lab_app_types.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="./assets/serve_lab_app_types.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<ol start="4" type="1">
<li>You will now see a form to configure a notebook server. Under <em>Name</em> put the name of your choice, <em>e.g.</em> the toolkit. Leave the rest of the fields unchanged. Now click <em>Submit</em>.</li>
</ol>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="./assets/serve_lab_form.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="./assets/serve_lab_form.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<ol start="5" type="1">
<li>The notebook server will now be created for you. Wait a few minutes to see the status <em>Running</em> in green. You can now click on its name to open it in a new tab.</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For JupyterLab you will need to use the password <code>scrnaseq</code>.</p>
</div>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="./assets/serve_lab_running.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="./assets/serve_lab_running.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If the status does not turn to <em>Running</em> within 5 minutes click on the three dots under <em>Actions</em> and then <em>Delete</em>. Wait a few minutes until you see the status <em>Deleted</em>. Now you can refresh the page and create a new instance starting from step 3.</p>
<p>In rare cases it may happen that your notebook server suddenly restarts. This could be due to an error that affected the notebook globally (for example, it ran out of temporary memory). You will see this on the page where you are working. A new notebook will start for you at the same URL within a few minutes.</p>
</div>
</div>
<p>In the case of both JupyterLab and RStudio you have access to persistent storage. This is mounted to the folder <code>/home/jovyan/work</code>. Files stored in this folder (<em>NB: only in this folder</em>) will be available even if a notebook suddenly restarts. You can also view, download these files or upload other files that will become visible in your instance through a <em>File Manager</em> that can be launched from the bottom of the <em>Project</em> overview page.</p>
<ol start="6" type="1">
<li>Inside the notebook server the script <code>download-labs.sh</code> is provided that will download the corresponding labs. It creates a <code>labs</code> folder with <code>.qmd</code> files (<strong>Seurat</strong>/<strong>Bioconductor</strong>) or <code>.ipynb</code> files (<strong>Scanpy</strong>). In the terminal, run any of the usage examples below:</li>
</ol>
<ul>
<li>Seurat</li>
</ul>
<pre><code>conda activate seurat
~/download-labs.sh "https://github.com/NBISweden" "workshop-scRNAseq" "compiled/labs" "seurat" "work/labs"</code></pre>
<ul>
<li>Bioconductor</li>
</ul>
<pre><code>conda activate seurat
~/download-labs.sh "https://github.com/NBISweden" "workshop-scRNAseq" "compiled/labs" "bioc" "work/labs"</code></pre>
<ul>
<li>Scanpy</li>
</ul>
<pre><code>conda activate scanpy
~/work/download-labs.sh "https://github.com/NBISweden" "workshop-scRNAseq" "compiled/labs" "scanpy" "labs"</code></pre>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember that data is only saved inside the <code>/home/jovyan/work</code> folder. If you run the labs <em>outside</em> this folder, all the labs and data files will be lost in case the JupyterLab server restarts or gets deleted (this can happen <em>e.g.</em> if it runs out of memory). It is recommended that at the end of each session you save the notebooks locally. You can do this by dowloading them through the <em>File Manager</em> interface available at the bottom of the project dashboard.</p>
</div>
</div>
<ol start="7" type="1">
<li>When you are done with a particular notebook server, you need to delete it before you can create a new one. Click on the three dots under <em>Actions</em>, and then click on <em>Delete</em>. Wait a few minutes until you see the status <em>Deleted</em>. Now you can refresh the page and start over.</li>
</ol>
</section>
<section id="option-b-run-docker-locally" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="option-b-run-docker-locally"><span class="header-section-number">2</span> <strong>Option B:</strong> Run Docker Locally</h2>
<section id="local-setup" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="local-setup"><span class="header-section-number">2.1</span> Local Setup</h3>
<p>If you don’t have Docker installed locally, please follow these <a href="../other/docker.html">instructions</a>.</p>
</section>
<section id="images" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="images"><span class="header-section-number">2.2</span> Images</h3>
<p>Separate Docker images are made available for <strong>Seurat</strong>/<strong>Bioconductor</strong> and <strong>Scanpy</strong> toolkits. Below you find an overview of the available docker images. Note the space requirements!</p>
<table class="table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Topic</th>
<th>Image</th>
<th>Size (GB)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Seurat/Bioconductor</td>
<td><code>ghcr.io/nbisweden/workshop-scrnaseq-seurat:20250320-2311</code></td>
<td>13.1GB</td>
</tr>
<tr class="even">
<td>Scanpy</td>
<td><code>ghcr.io/nbisweden/workshop-scrnaseq-scanpy:20250325-2256</code></td>
<td>16.9GB</td>
</tr>
</tbody>
</table>
</section>
<section id="seuratbioconductor" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="seuratbioconductor"><span class="header-section-number">2.3</span> Seurat/Bioconductor</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To avoid running out of memory, restart R (<em>Session &gt; Restart R</em>) after each lab.</p>
</div>
</div>
<pre><code>cd /path/to/labs  # replace this with the full path to the workshop compiled lab folder
docker pull --platform=linux/amd64 ghcr.io/nbisweden/workshop-scrnaseq-seurat:20250320-2311
docker run --platform=linux/amd64 --rm -p 8787:8787 -v ${PWD}:/home/jovyan/work ghcr.io/nbisweden/workshop-scrnaseq-seurat:20250320-2311</code></pre>
<p>Do not close the terminal! In the browser, go to <a href="localhost:8787">localhost:8787</a>.</p>
<p>Inside RStudio, the script <code>download-scripts-lab.sh</code> is provided that will download the corresponding labs. It creates a <code>labs</code> folder with <code>.qmd</code> files. In the terminal, run the commands below:</p>
<ul>
<li>Seurat</li>
</ul>
<pre><code>conda activate seurat
~/download-labs.sh "https://github.com/NBISweden" "workshop-scRNAseq" "compiled/labs" "seurat" "work/labs"</code></pre>
<ul>
<li>Bioconductor</li>
</ul>
<pre><code>conda activate seurat
~/download-labs.sh "https://github.com/NBISweden" "workshop-scRNAseq" "compiled/labs" "bioc" "work/labs"</code></pre>
<p>Navigate to <code>/home/jovyan/work/labs/</code> and open the <code>.qmd</code> files.</p>
</section>
<section id="scanpy" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="scanpy"><span class="header-section-number">2.4</span> Scanpy</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To avoid running out of memory, restart the kernel (<em>Kernel &gt; Restart Kernel</em>) after each lab.</p>
</div>
</div>
<pre><code>cd /path/to/labs  # replace this with the full path to the workshop compiled lab folder
docker pull --platform=linux/amd64 ghcr.io/nbisweden/workshop-scrnaseq-scanpy:20250325-2256
docker run --platform=linux/amd64 --rm -p 8888:8888 -v ${PWD}:/home/jovyan/work ghcr.io/nbisweden/workshop-scrnaseq-scanpy:20250325-2256</code></pre>
<p>Do not close the terminal! In the browser, go to <a href="localhost:8888/lab">localhost:8888</a>. Use the following credentials to log in to the JupyterLab server:</p>
<blockquote class="blockquote">
<p>Password: <code>scrnaseq</code></p>
</blockquote>
<p>Inside JupyterLab, the script <code>download-scripts-lab.sh</code> is provided that will download the corresponding labs. It creates a <code>labs</code> folder with <code>.ipynb</code> files. In the terminal, run the commands below:</p>
<pre><code>conda activate scanpy
~/work/download-labs.sh "https://github.com/NBISweden" "workshop-scRNAseq" "compiled/labs" "scanpy" "labs"</code></pre>
<p>Navigate to <code>/home/jovyan/work/labs/</code> and open the <code>.ipynb</code> files.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">2025 <a href="https://nbis.se">NBIS</a> | <a href="https://choosealicense.com/licenses/gpl-3.0/">GPL-3 License</a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Published with <a href="https://quarto.org/">Quarto</a> v1.3.450
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"loop":true,"openEffect":"zoom","selector":".lightbox","closeEffect":"zoom","descPosition":"bottom"});</script>



<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>