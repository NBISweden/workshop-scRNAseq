<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">

<title>Run labs in container</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../assets/images/banner.jpg);
background-size: cover;
      }
</style>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Fira+Mono&amp;family=Nunito:ital,wght@0,400;0,500;0,600;1,400;1,500;1,600&amp;display=swap" rel="stylesheet">

<link href="../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/logos/nbis-scilifelab.png" alt="nbis-scilifelab-logo" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_schedule.html" rel="" target="">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_contents.html" rel="" target="">
 <span class="menu-text">Contents</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_precourse.html" rel="" target="">
 <span class="menu-text">Precourse</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_syllabus.html" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_info.html" rel="" target="">
 <span class="menu-text">Info</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/NBISweden/workshop-scRNAseq/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Run labs in container</h1>
            <p class="subtitle lead">Instructions on running labs in Docker or Singularity container</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#option-a-run-singularity-on-uppmax-recommended" id="toc-option-a-run-singularity-on-uppmax-recommended" class="nav-link active" data-scroll-target="#option-a-run-singularity-on-uppmax-recommended"><span class="header-section-number">1</span> <strong>Option A:</strong> Run Singularity on Uppmax (Recommended)</a>
  <ul>
  <li><a href="#configure-uppmax" id="toc-configure-uppmax" class="nav-link" data-scroll-target="#configure-uppmax"><span class="header-section-number">1.1</span> Configure Uppmax</a>
  <ul class="collapse">
  <li><a href="#storage" id="toc-storage" class="nav-link" data-scroll-target="#storage"><span class="header-section-number">1.1.1</span> Storage</a></li>
  <li><a href="#compute" id="toc-compute" class="nav-link" data-scroll-target="#compute"><span class="header-section-number">1.1.2</span> Compute</a></li>
  </ul></li>
  <li><a href="#launch-rstudio" id="toc-launch-rstudio" class="nav-link" data-scroll-target="#launch-rstudio"><span class="header-section-number">1.2</span> Launch RStudio</a>
  <ul class="collapse">
  <li><a href="#seurat" id="toc-seurat" class="nav-link" data-scroll-target="#seurat"><span class="header-section-number">1.2.1</span> Seurat</a></li>
  <li><a href="#bioconductor" id="toc-bioconductor" class="nav-link" data-scroll-target="#bioconductor"><span class="header-section-number">1.2.2</span> Bioconductor</a></li>
  </ul></li>
  <li><a href="#connect-to-rstudio" id="toc-connect-to-rstudio" class="nav-link" data-scroll-target="#connect-to-rstudio"><span class="header-section-number">1.3</span> Connect to RStudio</a></li>
  <li><a href="#launch-jupyterlab" id="toc-launch-jupyterlab" class="nav-link" data-scroll-target="#launch-jupyterlab"><span class="header-section-number">1.4</span> Launch JupyterLab</a>
  <ul class="collapse">
  <li><a href="#scanpy" id="toc-scanpy" class="nav-link" data-scroll-target="#scanpy"><span class="header-section-number">1.4.1</span> Scanpy</a></li>
  </ul></li>
  <li><a href="#connect-to-jupyterlab" id="toc-connect-to-jupyterlab" class="nav-link" data-scroll-target="#connect-to-jupyterlab"><span class="header-section-number">1.5</span> Connect to JupyterLab</a></li>
  </ul></li>
  <li><a href="#option-b-run-docker-locally" id="toc-option-b-run-docker-locally" class="nav-link" data-scroll-target="#option-b-run-docker-locally"><span class="header-section-number">2</span> <strong>Option B:</strong> Run Docker Locally</a>
  <ul>
  <li><a href="#local-setup" id="toc-local-setup" class="nav-link" data-scroll-target="#local-setup"><span class="header-section-number">2.1</span> Local Setup</a></li>
  <li><a href="#images" id="toc-images" class="nav-link" data-scroll-target="#images"><span class="header-section-number">2.2</span> Images</a></li>
  <li><a href="#seurat-1" id="toc-seurat-1" class="nav-link" data-scroll-target="#seurat-1"><span class="header-section-number">2.3</span> Seurat</a></li>
  <li><a href="#bioconductor-1" id="toc-bioconductor-1" class="nav-link" data-scroll-target="#bioconductor-1"><span class="header-section-number">2.4</span> Bioconductor</a></li>
  <li><a href="#scanpy-1" id="toc-scanpy-1" class="nav-link" data-scroll-target="#scanpy-1"><span class="header-section-number">2.5</span> Scanpy</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Three different toolkits, namely <strong>Seurat</strong> (R/RStudio), <strong>Bioconductor</strong> (R/RStudio) and <strong>Scanpy</strong> (Python/Jupyter) are available to perform the scRNAseq analysis. The labs can be run on Uppmax using Singularity (Apptainer) or on your local machine using Docker. Both options provide the necessary environment to run the analysis.<br>
If you use Uppmax, you do not need any local installation or setup on your system but you need an Uppmax account and become a member of the Uppmax projects. If you use Docker, you will need to set up and run Docker yourself.</p>
</div>
</div>
<section id="option-a-run-singularity-on-uppmax-recommended" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="option-a-run-singularity-on-uppmax-recommended"><span class="header-section-number">1</span> <strong>Option A:</strong> Run Singularity on Uppmax (Recommended)</h2>
<section id="configure-uppmax" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="configure-uppmax"><span class="header-section-number">1.1</span> Configure Uppmax</h3>
<section id="storage" class="level4" data-number="1.1.1">
<h4 data-number="1.1.1" class="anchored" data-anchor-id="storage"><span class="header-section-number">1.1.1</span> Storage</h4>
<p>This setup needs to be run <strong>only once</strong> at the beginning of the workshop. It will connect you to Uppmax and create a folder with your username in the workshop’s directory.</p>
<p>First connect to Uppmax. Replace <code>&lt;username&gt;</code> with your actual user name.</p>
<pre><code>ssh -Y &lt;username&gt;@rackham.uppmax.uu.se</code></pre>
<p>Once you are connected, change into the working directory that you created in the Precourse instructions.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># change to project directory
cd /proj/naiss2023-23-648/nobackup/&lt;username&gt;</code></pre>
</div>
</div>
<p>Now we can fetch the scripts for the labs.</p>
<pre><code>git clone --depth 1 --single-branch --branch master https://github.com/nbisweden/workshop-scRNAseq.git
cd workshop-scRNAseq/compiled/labs</code></pre>
<p>Navigate to <code>compiled/labs/&lt;topic&gt;</code> directory to work on labs. And <code>&lt;topic&gt;</code> is either <code>seurat</code>, <code>bioc</code> or <code>scanpy</code>.</p>
</section>
<section id="compute" class="level4" data-number="1.1.2">
<h4 data-number="1.1.2" class="anchored" data-anchor-id="compute"><span class="header-section-number">1.1.2</span> Compute</h4>
<p>To run the labs you need to first create an <em>interactive session</em>.</p>
<p>Connect to Uppmax and change into your working directory (if not already done):</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>ssh -Y &lt;username&gt;@rackham.uppmax.uu.se
cd /proj/naiss2023-23-648/nobackup/&lt;username&gt;/workshop-scRNAseq/compiled/labs</code></pre>
</div>
</div>
<p>Then start an interactive session:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>interactive -A naiss2023-22-1345 -p core -n 4 -t 08:00:00</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Run the <code>interactive</code> command above only <strong>ONCE</strong> per day at the beginning of the practical session.</p>
</div>
</div>
<p>This command will connect you to a node with 5 cores for a duration of 8 hours. You can check the <em>node name</em> under the <code>NODELIST</code> column in the output of the following command:</p>
<pre><code>squeue -u &lt;username&gt;</code></pre>
<p>If you are disconnected from the interactive session, you can re-connect to your node with the following command:</p>
<pre><code>ssh -Y &lt;nodename&gt;</code></pre>
<p>If you get disconnected from Uppmax, reconnect to Uppmax as shown in the very first step, then check your job is running using <code>squeue</code> and login to the compute node as shown in the above step.</p>
</section>
</section>
<section id="launch-rstudio" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="launch-rstudio"><span class="header-section-number">1.2</span> Launch RStudio</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To avoid running out of memory, restart R (<em>Session &gt; Restart R</em>) after each lab.</p>
</div>
</div>
<section id="seurat" class="level4" data-number="1.2.1">
<h4 data-number="1.2.1" class="anchored" data-anchor-id="seurat"><span class="header-section-number">1.2.1</span> Seurat</h4>
<p>To launch RStudio server and run the <code>Seurat</code> labs perform the following steps:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>cd /proj/naiss2023-23-648/nobackup/&lt;username&gt;/workshop-scRNAseq/compiled/labs/seurat
/sw/courses/scrnaseq/singularity/launch_rstudio.sh /sw/courses/scrnaseq/singularity/2024-seurat-r4.3.0.sif</code></pre>
</div>
</div>
</section>
<section id="bioconductor" class="level4" data-number="1.2.2">
<h4 data-number="1.2.2" class="anchored" data-anchor-id="bioconductor"><span class="header-section-number">1.2.2</span> Bioconductor</h4>
<p>To launch RStudio server and run the <code>Bioconductor</code> labs perform the following steps:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>cd /proj/naiss2023-23-648/nobackup/&lt;username&gt;/workshop-scRNAseq/compiled/labs/bioc
/sw/courses/scrnaseq/singularity/launch_rstudio.sh /sw/courses/scrnaseq/singularity/2024-bioconductor-r4.3.0.sif</code></pre>
</div>
</div>
</section>
</section>
<section id="connect-to-rstudio" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="connect-to-rstudio"><span class="header-section-number">1.3</span> Connect to RStudio</h3>
<p>After executing the <code>launch_rstudio.sh</code> script, a message with <strong>your</strong> login credentials will be printed to your screen, and it looks similar to the one below.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do not close this terminal!</p>
</div>
</div>
<pre><code>        *************************************************
        *                                               *
        *  IMPORTANT: Do not close or exit this shell!  *
        *                                               *
        *************************************************

1. SSH tunnel from your workstation using the following command:

   ssh -N -L 8787:r483.uppmax.uu.se:58359 susanner@rackham3.uppmax.uu.se

   and point your web browser to http://localhost:8787

2. log in to RStudio Server using the following credentials:

   user: susanner
   password: scrnaseq

When done using RStudio Server, terminate the job by:

1. Exit the RStudio Session ("power" button in the top right corner of the RStudio window).
2. Issue the following command in both shells:

      CTRL-C</code></pre>
<p>Follow the instructions printed on the screen to launch the RStudio Server. Open a shell <em>locally</em> and run <em>your</em> <code>ssh</code> command from step 1. Then open <a href="localhost:8787">localhost:8787</a> in your web browser and log in to the RStudio Server using <strong>your</strong> <code>username</code> and <code>password</code> provided in step 2.</p>
<p>In RStudio, make sure you are in the correct working directory else set it.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">'/crex/proj/naiss2023-23-648/nobackup/&lt;username&gt;/workshop-scRNAseq/compiled/labs/&lt;topic&gt;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="launch-jupyterlab" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="launch-jupyterlab"><span class="header-section-number">1.4</span> Launch JupyterLab</h3>
<section id="scanpy" class="level4" data-number="1.4.1">
<h4 data-number="1.4.1" class="anchored" data-anchor-id="scanpy"><span class="header-section-number">1.4.1</span> Scanpy</h4>
<p>To launch JupyterLab and run the <strong>Scanpy</strong> labs using Jupyter notebooks perform the following steps:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To avoid running out of memory, restart the kernel (<em>Kernel &gt; Restart Kernel</em>) after each lab.</p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>cd /proj/naiss2023-23-648/nobackup/&lt;username&gt;/workshop-scRNAseq/compiled/labs/scanpy
/sw/courses/scrnaseq/singularity/launch_jupyter.sh /sw/courses/scrnaseq/singularity/2024-scanpy-py3.10.sif</code></pre>
</div>
</div>
</section>
</section>
<section id="connect-to-jupyterlab" class="level3" data-number="1.5">
<h3 data-number="1.5" class="anchored" data-anchor-id="connect-to-jupyterlab"><span class="header-section-number">1.5</span> Connect to JupyterLab</h3>
<p>After executing the <code>launch_jupyter.sh</code> script, a message with <em>your</em> login credentials will be printed to your screen, and it looks similar to the one below.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do not close this terminal!</p>
</div>
</div>
<pre><code>        *************************************************
        *                                               *
        *  IMPORTANT: Do not close or exit this shell!  *
        *                                               *
        *************************************************

1. SSH tunnel from your workstation using the following command:

   ssh -N -L 8888:r483.uppmax.uu.se:34968 susanner@rackham1.uppmax.uu.se

   point your web browser to http://localhost:8888/lab

2. Log in to JupyterLab using the password:

   scrnaseq

When done using JupyterLab, terminate the job by:

1. Shut down all kernels.
2. Issue the following command in both shells:

   CTRL-C</code></pre>
<p>Follow the instructions to launch the JupyterLab. Open a shell <strong>locally</strong> and run <strong>your</strong> <code>ssh</code> command from step 1. Then open <a href="localhost:8888/lab">localhost:8888/lab</a> in your web browser and log in to the JupyterLab using the password provided in step 2.</p>
</section>
</section>
<section id="option-b-run-docker-locally" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="option-b-run-docker-locally"><span class="header-section-number">2</span> <strong>Option B:</strong> Run Docker Locally</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The docker containers are not tested on Microsoft Windows OS.</p>
</div>
</div>
<section id="local-setup" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="local-setup"><span class="header-section-number">2.1</span> Local Setup</h3>
<p>Create a new directory at a suitable location. Now you can fetch the scripts for the labs. You can either download individual <code>.qmd</code> or <code>.ipynb</code> files from the <a href="../home_contents.html">Contents</a> page or clone the whole repo. If you clone the repo, navigate to <code>compiled/labs</code> to work on labs.</p>
<pre><code>git clone --depth 1 --single-branch --branch master https://github.com/nbisweden/workshop-scRNAseq.git
cd workshop-scRNAseq/compiled/labs</code></pre>
<p>If the <code>git</code> command is not available, you can simply go to <a href="https://github.com/NBISweden/workshop-scRNAseq" class="uri">https://github.com/NBISweden/workshop-scRNAseq</a> and download the repo as a zip file and unzip it in a suitable location.</p>
</section>
<section id="images" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="images"><span class="header-section-number">2.2</span> Images</h3>
<p>Separate Docker images are made available for <code>Seurat</code>, <code>Bioconductor</code> and <code>Scanpy</code> toolkits. An additional set of images are available for spatial analyses. All images follow the <code>registry/username/image:tag</code> convention. The image is always <code>ghcr.io/nbisweden/workshop-scrnaseq</code>. Add the appropriate tag based on the lab you are running.</p>
<p>An overview of the available docker images. Note the space requirements.</p>
<table class="table">
<thead>
<tr class="header">
<th>Topic</th>
<th>Image</th>
<th>Size (GB)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Seurat</td>
<td><code>2024-seurat-r4.3.0</code></td>
<td>8.87</td>
</tr>
<tr class="even">
<td>Bioconductor</td>
<td><code>2024-bioconductor-r4.3.0</code></td>
<td>7.89</td>
</tr>
<tr class="odd">
<td>Scanpy</td>
<td><code>2024-scanpy-py3.10</code></td>
<td>3.68</td>
</tr>
</tbody>
</table>
<table class="table">
<thead>
<tr class="header">
<th>Optional Topic</th>
<th>Image</th>
<th>Size (GB)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Seurat spatial</td>
<td><code>2024-seurat_spatial-r4.3.0</code></td>
<td>6.85</td>
</tr>
<tr class="even">
<td>Bioconductor spatial</td>
<td><code>2024-bioconductor_spatial-r4.3.0</code></td>
<td>6.47</td>
</tr>
<tr class="odd">
<td>Scanpy spatial</td>
<td><code>2024-scanpy_spatial-py3.10</code></td>
<td>3.68</td>
</tr>
</tbody>
</table>
</section>
<section id="seurat-1" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="seurat-1"><span class="header-section-number">2.3</span> Seurat</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To avoid running out of memory, restart R (<em>Session &gt; Restart R</em>) after each lab.</p>
</div>
</div>
<pre><code>cd /path/to/labs  # replace this with the full path to the workshop compiled lab folder
docker pull --platform=linux/amd64 ghcr.io/nbisweden/workshop-scrnaseq:2024-seurat-r4.3.0
docker run --platform=linux/amd64 --rm -p 8788:8787 -e PASSWORD=scrnaseq -v ${PWD}:/home/rstudio/workdir ghcr.io/nbisweden/workshop-scrnaseq:2024-seurat-r4.3.0</code></pre>
<p>Do not close the terminal. In the browser, go to <a href="localhost:8788">localhost:8788</a>.<br>
Use the following credentials to log in to the RStudio Server:</p>
<blockquote class="blockquote">
<p>User: <code>rstudio</code><br>
Password: <code>scrnaseq</code></p>
</blockquote>
<p>Navigate to <code>/home/rstudio/workdir/</code> and open qmd files</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-figure quarto-figure-left" style="flex-basis: 50.0%;justify-content: center;">
<figure class="figure">
<p><a href="assets/rstudio-login.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="RStudio login screen"><img src="assets/rstudio-login.jpg" class="img-fluid figure-img"></a></p>
<figcaption class="figure-caption">RStudio login screen</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-left" style="flex-basis: 50.0%;justify-content: center;">
<figure class="figure">
<p><a href="assets/rstudio-preview.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="RStudio preview"><img src="assets/rstudio-preview.jpg" class="img-fluid figure-img"></a></p>
<figcaption class="figure-caption">RStudio preview</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="bioconductor-1" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="bioconductor-1"><span class="header-section-number">2.4</span> Bioconductor</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To avoid running out of memory, restart R (<em>Session &gt; Restart R</em>) after each lab.</p>
</div>
</div>
<pre><code>cd /path/to/labs  # replace this with the full path to the workshop compiled lab folder
docker pull --platform=linux/amd64 ghcr.io/nbisweden/workshop-scrnaseq:2024-bioconductor-r4.3.0
docker run --platform=linux/amd64 --rm -p 8789:8787 -e PASSWORD=scrnaseq -v ${PWD}:/home/rstudio/workdir ghcr.io/nbisweden/workshop-scrnaseq:2024-bioconductor-r4.3.0</code></pre>
<p>Do not close the terminal. In the browser, go to <a href="localhost:8789">localhost:8789</a>. Use the following credentials to log in to the RStudio Server:</p>
<blockquote class="blockquote">
<p>User: <code>rstudio</code><br>
Password: <code>scrnaseq</code></p>
</blockquote>
<p>Navigate to <code>/home/rstudio/workdir/</code> and open qmd files</p>
</section>
<section id="scanpy-1" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="scanpy-1"><span class="header-section-number">2.5</span> Scanpy</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To avoid running out of memory, restart the kernel (<em>Kernel &gt; Restart Kernel</em>) after each lab.</p>
</div>
</div>
<pre><code>cd /path/to/labs  # replace this with the full path to the workshop compiled lab folder
docker pull --platform=linux/amd64 ghcr.io/nbisweden/workshop-scrnaseq:2024-scanpy-py3.10
docker run --platform=linux/amd64 --rm -p 8888:8888 -v ${PWD}:/home/jovyan/workdir ghcr.io/nbisweden/workshop-scrnaseq:2024-scanpy-py3.10</code></pre>
<p>Do not close the terminal. At the end of the prompt, you will see a URL that starts with <code>http://127.0.0.1</code>, similar to the one below:</p>
<pre><code>http://127.0.0.1:8888/lab?token=0a1d9ec51b91528a1d1fe2ad2c74f59ecb94c47070c2911d</code></pre>
<p>Note that your token value will be different. Copy the entire URL (with the token) and paste it in your browser.</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-figure quarto-figure-left" style="flex-basis: 50.0%;justify-content: center;">
<figure class="figure">
<p><a href="assets/jupyter-home.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="JupyterLab home"><img src="assets/jupyter-home.jpg" class="img-fluid figure-img"></a></p>
<figcaption class="figure-caption">JupyterLab home</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-left" style="flex-basis: 50.0%;justify-content: center;">
<figure class="figure">
<p><a href="assets/jupyter-preview.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="JupyterLab preview"><img src="assets/jupyter-preview.jpg" class="img-fluid figure-img"></a></p>
<figcaption class="figure-caption">JupyterLab preview</figcaption>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">2025 <a href="https://nbis.se">NBIS</a> | <a href="https://choosealicense.com/licenses/gpl-3.0/">GPL-3 License</a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Published with <a href="https://quarto.org/">Quarto</a> v1.3.450
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"openEffect":"zoom","loop":true,"closeEffect":"zoom","selector":".lightbox","descPosition":"bottom"});</script>



<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>